FROM ubuntu as builder
RUN apt-get update && \
    apt-get install wget curl make gcc perl -y && \
    apt-get install libapr1-dev libaprutil1-dev libpcre3-dev -y && \
    wget https://archive.apache.org/dist/httpd/httpd-2.4.50.tar.gz && \
    tar -xf httpd-2.4.50.tar.gz && \
    ./httpd-2.4.50/configure && \
    make && make install

ADD httpd.conf /usr/local/apache2/conf/httpd.conf

FROM ubuntu

COPY --from=builder /usr/local/apache2 /usr/local/apache2

RUN apt-get update && apt-get install libaprutil1 -y

EXPOSE 8080

ENTRYPOINT ["/usr/local/apache2/bin/httpd", "-D", "FOREGROUND"]
